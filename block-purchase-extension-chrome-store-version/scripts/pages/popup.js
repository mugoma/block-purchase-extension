!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{addAddTimerBtnClickEventListener:()=>$,addDeleteTimerLinkClickEventListener:()=>H,addOptionsPageLinkClickEventListener:()=>V,addPurchaseFeedbackBtnClickEventListeners:()=>U,addResetTimerBtnClickEventListeners:()=>_,addStatsPageLinkClickEventListener:()=>Y,executeAddTimerButtonClicked:()=>N,executeDeleteTimerLinkClicked:()=>F,executePurchaseFeedbackBtnClicked:()=>J,executeResetTimerButtonClicked:()=>R,handleDOMLoad:()=>z});const n="set-timer",r="reset-timer",o="delete-timer",i="get-product-price",c="add-purchase-stat",a="deferred_purchases",d="completed_purchases";function s(e){return new Promise((t=>{chrome.storage.local.get(e,(n=>{t(void 0===n[e]?void 0:n[e].time)}))}))}var m,l;const u="countdown-timer",f="reset-timer-btn",h="existing-timer-container",p="add-timer-btn",g="add-timer-container",y="cls-hidden",v="delete-timer-link",b="options-page-link",E="stats-page-links",k="completed-timer-container",L="purchase-feedback",w="completed-timer-ask-feedback",B="completed-timer-completed-feedback",T="my-statistics.html";function P(e){if(e&&e.length>0)return e[0].url;console.error("Failed to get the current tab's URL.")}function C(e,t){null!==t&&(!0===e?t.classList.remove(y):t.classList.add(y))}function I(e){C(e,document.getElementById(g))}function S(e,t=!0){I(!1),!0===function(e,t,n="",r=!0){const o=1==r?1e3:6e4;var i=new Date(e).getTime()-Date.now();return!(i<=0||(l=setInterval((()=>{const e=Math.floor(i/1e3),c=Math.floor(e/3600),a=Math.floor(e%3600/60),d=Math.floor(e%60),s=!0===r?`:${d.toString().padStart(2,"0")}`:"",m=`${c.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}${s}`,u=document.getElementById(t);u&&(u.innerHTML=n+m),(i-=o)<=0&&(clearInterval(l),M(!1),D(!0))}),o),0))}(new Date(e),u,"Time left: ",t)?(M(!0),D(!1)):(M(!1),D(!0),chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>P(e))).then((e=>Promise.all([s(e),chrome.storage.local.get([a,d]).then((e=>({deferred:e[a]?JSON.parse(e[a]):[],completed:e[d]?JSON.parse(e[d]):[]})))]).then((t=>{const n=t[0];return!!t[1].deferred.concat(t[1].completed).find((t=>!(t?.url!==e&&t!=e||t?.timerEndTime&&new Date(n).getTime()!=new Date(t.timerEndTime).getTime())))})).catch((e=>(console.error("An error occurred while checking feedback:",e),!1))))).then((e=>{1==e&&j()})))}function M(e){C(e,document.getElementById(h))}function D(e){C(e,document.getElementById(k))}function O(){clearInterval(m)}function x(e){window.open(chrome.runtime.getURL("../pages/"+e))}function j(){C(!1,document.getElementById(w)),C(!0,document.getElementById(B))}function A(){return chrome.tabs.query({currentWindow:!0,active:!0}).then((e=>{var t=e[0];return void 0!==t.id?chrome.tabs.sendMessage(t.id,{action:i}).then((e=>e),(()=>0)):Promise.resolve(0)}))}function W(){return chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>P(e)))}function q(e="set-timer",t,n){return chrome.runtime.sendMessage({action:e,url:t,initiator:"popup",price:n})}function N(){Promise.all([W(),A()]).then((e=>{const[t,r]=e;q(n,t,r).then((e=>{S(e)}))}))}function $(){const e=document.getElementById(p);e&&e.addEventListener("click",N)}function R(){O(),Promise.all([W(),A()]).then((e=>{const[t,n]=e;q(r,t,n).then((e=>{S(e)}))}))}function _(){Array.from(document.getElementsByClassName(f)).forEach((e=>{e.addEventListener("click",R)}))}function F(){chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>{var t=P(e);chrome.runtime.sendMessage({action:o,url:t,initiator:"popup"}).then((()=>{O(),I(!0),M(!1)}))}))}function H(){const e=document.getElementById(v);e&&e.addEventListener("click",F)}function J(e){W().then((t=>{(function(e){return new Promise((t=>{chrome.storage.local.get(e,(n=>{t(n[e])}))}))})(t).then((n=>{const[r,o]=[n.time,n.price],i=e.target,a=!i||"y"!==i.dataset.proceededWithPurchase;chrome.runtime.sendMessage({action:c,url:t,initiator:"popup",wasDeferred:a,timerEndTime:r,price:o}).then((()=>{j()}))}))}))}function U(){Array.from(document.getElementsByClassName(L)).forEach((e=>{e.addEventListener("click",J)}))}function V(){const e=document.getElementById(b);e&&e.addEventListener("click",(()=>{chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():x("options.html")}))}function Y(){Array.from(document.getElementsByClassName(E)).forEach((e=>{e.addEventListener("click",(()=>{x(T)}))}))}function z(){chrome.storage.local.get({timer:!0,timerDuration:24}).then((e=>{!1===e.timer?function(){const e=document.getElementById(p);e&&(e.classList.add("dull-buy-btn"),e.disabled=!0,e.title="Timer is disabled. Visit the options page to enable it.")}():function(e){const t=`Yes! Add ${e} Hour countdown`,n=document.getElementById(p);n&&(n.innerText=t,n.classList.add("background-brown"))}(e.timerDuration)})),chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>{const t=P(e);chrome.storage.local.get(t,(e=>{var n=e[t];null==n?I(!0):S(n.time)}))})),$(),H(),_(),V(),Y(),U()}return document.addEventListener("DOMContentLoaded",z),t})()));