!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{addAddTimerBtnClickEventListener:()=>F,addDeleteTimerLinkClickEventListener:()=>Q,addOptionsPageLinkClickEventListener:()=>z,addPurchaseFeedbackBtnClickEventListeners:()=>Y,addReflectionQuestionnairePageLinkClickEventListeners:()=>G,addResetTimerBtnClickEventListeners:()=>H,addStatsPageLinkClickEventListener:()=>K,executeAddTimerButtonClicked:()=>_,executeDeleteTimerLinkClicked:()=>J,executePurchaseFeedbackBtnClicked:()=>V,executeResetTimerButtonClicked:()=>U,handleDOMLoad:()=>X});const n="set-timer",r="reset-timer",o="delete-timer",i="get-product-price",c="add-purchase-stat",a="redirect",d="deferred_purchases",s="completed_purchases",m="source",l="reflection-questionnaire-page-links";function u(e){return new Promise((t=>{chrome.storage.local.get(e,(n=>{t(void 0===n[e]?void 0:n[e].time)}))}))}var f,h;const g="countdown-timer",p="reset-timer-btn",y="existing-timer-container",v="add-timer-btn",E="add-timer-container",k="cls-hidden",b="delete-timer-link",L="options-page-link",B="stats-page-links",w="completed-timer-container",P="purchase-feedback",T="completed-timer-ask-feedback",C="completed-timer-completed-feedback",I="my-statistics.html";function M(e){if(e&&e.length>0)return e[0].url;console.error("Failed to get the current tab's URL.")}function S(e,t){null!==t&&(!0===e?t.classList.remove(k):t.classList.add(k))}function D(e){S(e,document.getElementById(E))}function O(e,t=!0){D(!1),!0===function(e,t,n="",r=!0){const o=1==r?1e3:6e4;var i=new Date(e).getTime()-Date.now();return!(i<=0||(h=setInterval((()=>{const e=Math.floor(i/1e3),c=Math.floor(e/3600),a=Math.floor(e%3600/60),d=Math.floor(e%60),s=!0===r?`:${d.toString().padStart(2,"0")}`:"",m=`${c.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}${s}`,l=document.getElementById(t);l&&(l.innerHTML=n+m),(i-=o)<=0&&(clearInterval(h),x(!1),A(!0))}),o),0))}(new Date(e),g,"Time left: ",t)?(x(!0),A(!1)):(x(!1),A(!0),chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>M(e))).then((e=>Promise.all([u(e),chrome.storage.local.get([d,s]).then((e=>({deferred:e[d]?JSON.parse(e[d]):[],completed:e[s]?JSON.parse(e[s]):[]})))]).then((t=>{const n=t[0];return!!t[1].deferred.concat(t[1].completed).find((t=>!(t?.url!==e&&t!=e||t?.timerEndTime&&new Date(n).getTime()!=new Date(t.timerEndTime).getTime())))})).catch((e=>(console.error("An error occurred while checking feedback:",e),!1))))).then((e=>{1==e&&N()})))}function x(e){S(e,document.getElementById(y))}function A(e){S(e,document.getElementById(w))}function j(){clearInterval(f)}function q(e){window.open(function(e){return chrome.runtime.getURL("../pages/"+e)}(e))}function N(){S(!1,document.getElementById(T)),S(!0,document.getElementById(C))}function R(){return chrome.tabs.query({currentWindow:!0,active:!0}).then((e=>{var t=e[0];return void 0!==t.id?chrome.tabs.sendMessage(t.id,{action:i}).then((e=>e),(()=>0)):Promise.resolve(0)}))}function W(){return chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>M(e)))}function $(e="set-timer",t,n){return chrome.runtime.sendMessage({action:e,url:t,initiator:"popup",price:n})}function _(){Promise.all([W(),R()]).then((e=>{const[t,r]=e;$(n,t,r).then((e=>{O(e)}))}))}function F(){const e=document.getElementById(v);e&&e.addEventListener("click",_)}function U(){j(),Promise.all([W(),R()]).then((e=>{const[t,n]=e;$(r,t,n).then((e=>{O(e)}))}))}function H(){Array.from(document.getElementsByClassName(p)).forEach((e=>{e.addEventListener("click",U)}))}function J(){chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>{var t=M(e);chrome.runtime.sendMessage({action:o,url:t,initiator:"popup"}).then((()=>{j(),D(!0),x(!1)}))}))}function Q(){const e=document.getElementById(b);e&&e.addEventListener("click",J)}function V(e){W().then((t=>{(function(e){return new Promise((t=>{chrome.storage.local.get(e,(n=>{t(n[e])}))}))})(t).then((n=>{const[r,o]=[n.time,n.price],i=e.target,a=!i||"y"!==i.dataset.proceededWithPurchase;chrome.runtime.sendMessage({action:c,url:t,initiator:"popup",wasDeferred:a,timerEndTime:r,price:o}).then((()=>{N()}))}))}))}function Y(){Array.from(document.getElementsByClassName(P)).forEach((e=>{e.addEventListener("click",V)}))}function z(){const e=document.getElementById(L);e&&e.addEventListener("click",(()=>{chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():q("options.html")}))}function G(){Array.from(document.getElementsByClassName(l)).forEach((e=>{e.addEventListener("click",(()=>{W().then((e=>{chrome.runtime.sendMessage({action:a,url:chrome.runtime.getURL("pages/reflect.html")+"?"+m+"="+e})}))}))}))}function K(){Array.from(document.getElementsByClassName(B)).forEach((e=>{e.addEventListener("click",(()=>{q(I)}))}))}function X(){chrome.storage.local.get({timer:!0,timerDuration:24}).then((e=>{!1===e.timer?function(){const e=document.getElementById(v);e&&(e.classList.add("dull-buy-btn"),e.disabled=!0,e.title="Timer is disabled. Visit the options page to enable it.")}():function(e){const t=`Yes! Add ${e} Hour countdown`,n=document.getElementById(v);n&&(n.innerText=t,n.classList.add("background-brown"))}(e.timerDuration)})),chrome.tabs.query({active:!0,currentWindow:!0}).then((e=>{const t=M(e);chrome.storage.local.get(t,(e=>{var n=e[t];null==n?D(!0):O(n.time)}))})),F(),Q(),H(),z(),K(),Y(),G()}return document.addEventListener("DOMContentLoaded",X),t})()));