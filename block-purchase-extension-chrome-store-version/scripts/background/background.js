!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(self,(()=>(()=>{"use strict";const e="set-timer",t="reset-timer",r="delete-timer",n=36e5;function o(e,t,r){var n={};return n[e]={time:t,amount:r},chrome.storage.local.set(n).then((()=>t))}function i(){return chrome.storage.local.get({timerDuration:24}).then((e=>e.timerDuration))}function a(e,t,r,n="popup"){return chrome.tabs.query({url:e},(function(e){e[0]&&void 0!==e[0].id&&chrome.tabs.sendMessage(e[0].id,{initiator:n,endTime:r,action:t})}))}return chrome.runtime.onMessage.addListener(((c,s,u)=>{const l=c.initiator;if(c.action===e){const[t,r]=[c.url,c.price];(function(e,t){return function(e){return new Promise((t=>{chrome.storage.local.get(e,(r=>{t(void 0===r[e]?void 0:r[e].time)}))}))}(e).then((r=>null==r?i().then((r=>{var i=new Date(Date.now()+r*n).toString();return o(e,i,t)})):"object"==typeof r&&null!==r&&"time"in r?r.time:r))})(t,r).then((e=>(u(e),e))).then((r=>{a(t,e,r,l)}))}else if(c.action===t){const[e,r]=[c.url,c.price];(function(e,t){return chrome.storage.local.remove(e).then((()=>i().then((r=>{var i=new Date(Date.now()+r*n).toString();return o(e,i,t)}))))})(e,r).then((e=>(u(e),e))).then((r=>{a(e,t,r,l)}))}else if(c.action===r){const e=c.url;chrome.storage.local.remove(e),u("Deleted"),a(e,r,null,l)}else"add-purchase-stat"===c.action&&(m=c.url,d=c.wasDeferred,h=c.timerEndTime,f=c.price,p=!0===d?"deferred_purchases":"completed_purchases",new Promise((e=>{chrome.storage.local.get(p,(t=>{e(t)}))})).then((e=>{const t=e[p];var r;(r=null==t?[]:Array(...JSON.parse(t))).unshift({url:m,timerEndTime:h,price:f});const n={};return n[p]=JSON.stringify(r),chrome.storage.local.set(n)}))).then((()=>{u("Completed")}));var m,d,h,f,p;return!0})),chrome.runtime.onInstalled.addListener((function(e){let t=chrome.runtime.getURL("pages/onboarding.html");e.reason===chrome.runtime.OnInstalledReason.INSTALL&&chrome.tabs.create({url:t})})),{}})()));